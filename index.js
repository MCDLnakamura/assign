new Vue({
  el: '#app',
  data () {
    return {
      prefectures: null,
      population: null,
      id: 0,
      api_key:'TP6LHy98HM4VjlC6POePIl6FUIDlpSvj9TmA0QF8',
      // api_key:'0fwgv9E1dzvJ8XJ0bRpZpcnIWTT188EUYxZPdzw9',
      // year: [],
      // value: [],
      sel_pre_code:[],
      myChart: null,
      y_label:[
        '1960','1965','1970','1975','1980','1985','1990','1995','2000','2005','2010','2015','2020','2025','2030','2035','2040','2045'
      ],
      // data:[],
      name:['北海道','青森県','岩手県','宮城県','秋田県','山形県','福島県','茨城県','栃木県','群馬県','埼玉県','千葉県','東京都','神奈川県','新潟県','富山県','石川県','福井県','山梨県','長野県','岐阜県','静岡県','愛知県','三重県','滋賀県','京都府','大阪府','兵庫県','奈良県','和歌山県','鳥取県','島根県','岡山県','広島県','山口県','徳島県','香川県','愛媛県','高知県','福岡県','佐賀県','長崎県','熊本県','大分県','宮崎県','鹿児島県','沖縄県'],
      data:[
      ['5039206','5171800','5184287','5338206','5575989','5679439','5643647','5692321','5683062','5627737','5506419','5381733','5224614','5016554','4791592','4546357','4280427','4004973',],
      ['1426606','1416591','1427520','1468646','1523907','1524448','1482873','1481663','1475728','1436657','1373339','1308265','1237984','1157332','1076393','993737','908974','823610'],
      ['1448517','1411118','1371383','1385563','1421927','1433611','1416928','1419505','1416180','1385041','1330147','1279594','1210534','1161638','1096141','1028673','957788','884518',],
      ['1743195','1753126','1819223','1955267','2082320','2176295','2248558','2328739','2365320','2360218','2348165','2333899','2301996','2227471','2143601','2046219','1933258','1809021',],
      ['1335580','1279835','1241376','1232481','1256745','1254032','1227478','1213667','1189279','1145501','1085997','1023119','959502','885285','814295','744014','672617','601649',],
      ['1320664','1263103','1225618','1220302','1251917','1261662','1258390','1256958','1244147','1216181','1168924','1123891','1068027','1015910','957314','897075','833844','768490'],
      ['2051137','1983754','1946077','1970616','2035272','2080304','2104058','2133592','2126935','2091319','2029064','1914039','1833152','1733103','1635235','1533521','1426392','1314903',],
      ['2047024', '2056154', '2143551', '2342198', '2558007', '2725005', '2845382', '2955530', '2985676', '2975167', '2969770', '2916976', '2867009', '2750204', '2638185', '2512144', '2376146', '2235686',],
      ['1513624', '1521656', '1580021', '1698003', '1792201', '1866066', '1935168', '1984390', '2004817', '2016631', '2007683', '1974255', '1933146', '1872842', '1805949', '1730414', '1647288', '1560619',],
      ['1578476', '1605584', '1658909', '1756480', '1848562', '1921259', '1966265', '2003540', '2024852', '2024135', '2008068', '1973115', '1939110', '1865565', '1796233', '1719914', '1637642', '1552950',],
      ['2430871', '3014983', '3866472', '4821340', '5420480', '5863678', '6405319', '6759311', '6938006', '7054243', '7194556', '7266534', '7344765', '7202953', '7076167', '6909319', '6721414', '6524800',],
      ['2306010', '2701770', '3366624', '4149147', '4735424', '5148163', '5555429', '5797782', '5926285', '6056462', '6216289', '6222666', '6284480', '6118170', '5985915', '5822882', '5645611', '5463363',],
      ['9683802', '10869244', '11408071', '11673554', '11618281', '11829363', '11855563', '11773605', '12064101', '12576601', '13159388', '13515271', '14047594', '13845936', '13882538', '13851782', '13758624', '13606683', ],
      ['3443176', '4430743', '5472247', '6397748', '6924348', '7431974', '7980391', '8245900', '8489974', '8791597', '9048331', '9126214', '9237337', '9069562', '8933474', '8750958', '8541016', '8312524', ],
      ['2442037', '2398931', '2360982', '2391938', '2451357', '2478470', '2474583', '2488364', '2475733', '2431459', '2374450', '2304264', '2201272', '2131156', '2031445', '1926432', '1814665', '1698989', ],
      ['1032614', '1025465', '1029695', '1070791', '1103459', '1118369', '1120161', '1123125', '1120851', '1111729', '1093247', '1066328', '1034814', '996442', '954745', '910161', '863342', '817398', ],
      ['973418', '980499', '1002420', '1069872', '1119304', '1152325', '1164628', '1180068', '1180977', '1174026', '1169788', '1154008', '1132526', '1104368', '1070727', '1032500', '990439', '947918', ],
      ['752696', '750557', '744230', '773599', '794354', '817633', '823585', '826996', '828944', '821592', '806314', '786740', '766863', '737898', '709753', '679595', '647241', '614144', ],
      ['782062', '763194', '762029', '783050', '804256', '832832', '852966', '881996', '888172', '884515', '863075', '834930', '809974', '763274', '724352', '683945', '641932', '598935', ],
      ['1981433', '1958007', '1956917', '2017564', '2083934', '2136927', '2156627', '2193984', '2215168', '2196114', '2152449', '2098804', '2048011', '1957953', '1877667', '1793174', '1704857', '1614511', ],
      ['1638399', '1700365', '1758954', '1867978', '1960107', '2028536', '2066569', '2100315', '2107700', '2107226', '2080773', '2031903', '1978742', '1901131', '1820918', '1735195', '1645898', '1556529', ],
      ['2756271', '2912521', '3089895', '3308799', '3446804', '3574692', '3670840', '3737689', '3767393', '3792377', '3765007', '3700305', '3633202', '3506064', '3380104', '3241803', '3094264', '2942865', ],
      ['4206313', '4798653', '5386163', '5923569', '6221638', '6455172', '6690603', '6868336', '7043300', '7254704', '7410719', '7483128', '7542415', '7455615', '7359302', '7227958', '7070766', '6899465', ],
      ['1485054', '1514467', '1543083', '1626002', '1686936', '1747311', '1792514', '1841358', '1857339', '1866963', '1854724', '1815865', '1770254', '1709820', '1645050', '1575867', '1503635', '1430804', ],
      ['842695', '853385', '889768', '985621', '1079898', '1155844', '1222411', '1287005', '1342832', '1380361', '1410777', '1412916', '1413610', '1394593', '1371841', '1341440', '1304201', '1262924', ],
      ['1993403', '2102808', '2250087', '2424856', '2527330', '2586574', '2602460', '2629592', '2644391', '2647660', '2636092', '2610353', '2578087', '2509875', '2430849', '2338843', '2238226', '2136807', ],
      ['5504746', '6657189', '7620480', '8278925', '8473446', '8668095', '8734516', '8797268', '8805081', '8817166', '8865245', '8839469', '8837685', '8526202', '8262029', '7962983', '7649229', '7335352', ],
      ['3906487', '4309944', '4667928', '4992140', '5144892', '5278050', '5405040', '5401877', '5550574', '5590601', '5588133', '5534800', '5465002', '5306083', '5139095', '4948778', '4742647', '4532499', ],
      ['781058', '825965', '930160', '1077491', '1209365', '1304866', '1375481', '1430862', '1442795', '1421310', '1400728', '1364316', '1324473', '1264574', '1202479', '1135578', '1066267', '998076', ],
      ['1002191', '1026975', '1042736', '1072118', '1087012', '1087206', '1074325', '1080435', '1069912', '1035969', '1002198', '963579', '922584', '875553', '829087', '781816', '734325', '688031', ],
      ['599135', '579853', '568777', '581311', '604221', '616024', '615722', '614929', '613289', '607012', '588667', '573441', '553407', '536747', '516255', '494893', '472156', '448529', ],
      ['888886', '821620', '773575', '768886', '784795', '794629', '781021', '771441', '761503', '742223', '717397', '694352', '671126', '642787', '615424', '587556', '558290', '528988', ],
      ['1670454', '1645135', '1707026', '1814305', '1871023', '1916906', '1925877', '1950750', '1950828', '1957264', '1945276', '1921525', '1888432', '1846230', '1796872', '1741517', '1681383', '1620031', ],
      ['2184043', '2281146', '2436135', '2646324', '2739161', '2819200', '2849847', '2881748', '2878915', '2876642', '2860750', '2843990', '2799702', '2758220', '2689284', '2609116', '2520520', '2428818', ],
      ['1602207', '1543573', '1511448', '1555218', '1587079', '1601627', '1572616', '1555543', '1527964', '1492606', '1451338', '1404729', '1342059', '1292809', '1230324', '1165692', '1099619', '1035661', ],
      ['847274', '815115', '791111', '805166', '825261', '834889', '831598', '832427', '824108', '809950', '785491', '755733', '719559', '687680', '651234', '613686', '574474', '535370', ],
      ['918867', '900845', '907897', '961292', '999864', '1022569', '1023412', '1027006', '1022890', '1012400', '995842', '976263', '950244', '921343', '888509', '853054', '814677', '776478', ],
      ['1500687', '1446384', '1418124', '1465215', '1506637', '1529983', '1515025', '1506700', '1493092', '1467815', '1431493', '1385262', '1334841', '1274128', '1212388', '1148113', '1080610', '1012995', ],
      ['854595', '812714', '786882', '808397', '831275', '839784', '825034', '816704', '813949', '796292', '764456', '728276', '691527', '652757', '614449', '575728', '536443', '498460', ],
      ['4006679', '3964611', '4027416', '4292963', '4553461', '4719259', '4811050', '4933393', '5015699', '5049908', '5071968', '5101556', '5135214', '5042774', '4955295', '4841878', '4704812', '4554486', ],
      ['942874', '871885', '838468', '837674', '865574', '880013', '877851', '884316', '876654', '866369', '849788', '832832', '811442', '784789', '757242', '728170', '696815', '663781', ],
      ['1760421', '1641245', '1570245', '1571912', '1590564', '1593968', '1562959', '1544934', '1516523', '1478632', '1426779', '1377187', '1312317', '1257939', '1192223', '1124291', '1053851', '982200', ],
      ['1856192', '1770736', '1700229', '1715273', '1790327', '1837747', '1840326', '1859793', '1859344', '1842233', '1817426', '1786170', '1738301', '1691314', '1635901', '1576825', '1511793', '1442442', ],
      ['1239655', '1187480', '1155566', '1190314', '1228913', '1250214', '1236942', '1231306', '1221140', '1209571', '1196529', '1166338', '1123852', '1089084', '1044038', '996732', '946917', '896653', ],
      ['1134590', '1080692', '1051105', '1085055', '1151587', '1175543', '1168907', '1175819', '1170007', '1153042', '1135233', '1104069', '1069576', '1023170', '976626', '928034', '876863', '824806', ],
      ['1963104', '1853541', '1729150', '1723902', '1784623', '1819270', '1797824', '1794224', '1786194', '1753179', '1706242', '1648177', '1588256', '1510970', '1436753', '1361575', '1284036', '1204146', ],
      ['883122', '934176', '945111', '1042572', '1106559', '1179097', '1222398', '1273440', '1318220', '1361594', '1392818', '1433566', '1467480', '1468236', '1469847', '1465761', '1452321', '1428305', ],
      ]
    }
  },
  methods:{
    rev_population: function(pre_num){
      var parent_url = 'https://opendata.resas-portal.go.jp/api/v1/population/composition/perYear?cityCode=-&prefCode=';
      axios.get(parent_url+pre_num, { headers: { 'X-API-KEY': this.api_key } })
      .then(response => (this.population = response.data.result.data.find(
        (item) => (item.label === '総人口')
        )));
      if (this.population) {return this.population.data}
    },
    rev_value: function(pre_num){
      var input=this.rev_population(pre_num);
      this.data=[];
      for(item in input){
        this.data.push(item.value)
      }
      if (this.data) {return this.data}
    },
    clear: function(){
      if (myChart) {
        this.myChart.destroy();
        var ctx = document.getElementById('myChart').getContext('2d');
        this.myChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: this.y_label,
            datasets: [{label: '都道府県',data: [],}]
          },
          options: {
              scales: {
                yAxes: [{ticks: {min: 0,suggestedMax: 1000000,}}]
              }
            },})

      }
    },
    displayGraph:function(){
      var ctx = document.getElementById('myChart').getContext('2d');
        var dataset=[]
        for (let hoge=0; hoge<48; hoge++){
        console.log(hoge)
          if (this.sel_pre_code.includes(hoge)){
            dataset.push({
              label: this.name[hoge-1],
              fill: false,
              data: this.data[hoge-1]
            })
          }
        }
        console.log(dataset)
          this.myChart = new Chart(ctx, {
            type: 'line',
            data: {
              labels: this.y_label,
              datasets:  dataset,
              },
              options: {
                scales: {
                  yAxes: [{ticks: {min: 0,suggestedMax: 1000000,}}]
                }
              }
            });
    }},

    
    mounted:
    function(){
      var ctx = document.getElementById('myChart').getContext('2d');
      this.myChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: this.y_label,
          datasets: [{label: '都道府県',data: [],} ]
        },
        options: {
            scales: {
              yAxes: [{ticks: {min: 0,suggestedMax: 1000000,}}]
            }
          }
        });
        var prefectures_url = 'https://opendata.resas-portal.go.jp/api/v1/prefectures';
        axios.get(prefectures_url, { headers: { 'X-API-KEY': this.api_key } }) 
        .then(response => (this.prefectures = response.data.result));
      },


  });
